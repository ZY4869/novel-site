# ğŸ“š Novel Site â€” é›¶æˆæœ¬ç§äººå°è¯´ç«™

[![Stars](https://img.shields.io/github/stars/xingzihai/novel-site?style=flat-square)](https://github.com/xingzihai/novel-site/stargazers)
[![License](https://img.shields.io/github/license/xingzihai/novel-site?style=flat-square)](LICENSE)
[![Deploy](https://img.shields.io/badge/deploy-Cloudflare%20Pages-orange?style=flat-square)](https://pages.cloudflare.com)

> Cloudflare Pages + D1 + R2 + Functions å…¨æ ˆæ–¹æ¡ˆï¼Œå…¨ç¨‹ä¸èŠ±ä¸€åˆ†é’±

## âœ¨ äº®ç‚¹é€Ÿè§ˆ

- ğŸ’° **é›¶æˆæœ¬** â€” å®Œå…¨è¿è¡Œåœ¨ Cloudflare å…è´¹å¥—é¤ä¸Šï¼Œä¸éœ€è¦æœåŠ¡å™¨ã€åŸŸåã€CDN
- âš¡ **5 åˆ†é’Ÿéƒ¨ç½²** â€” å…‹éš†ä»“åº“åå‡ æ¡å‘½ä»¤å³å¯ä¸Šçº¿
- ğŸ“– **åŠŸèƒ½å®Œæ•´** â€” ä¹¦æ¶ã€é˜…è¯»ã€æœç´¢ã€ä¹¦ç­¾ã€ç»Ÿè®¡ã€TXT/EPUB å¯¼å…¥ã€å¤šç®¡ç†å‘˜ã€æ ‡ç­¾åˆ†ç±»
- ğŸ” **å®‰å…¨åŠ å›º** â€” PBKDF2 å¯†ç å“ˆå¸Œã€Session Tokenã€IP é™æµã€CSP/HSTS å®‰å…¨å¤´
- ğŸ› ï¸ **çº¯åŸç”Ÿ** â€” é›¶æ¡†æ¶ä¾èµ–ï¼ˆæ—  React/Vueï¼‰ï¼Œçº¯ HTML/CSS/JSï¼Œæ”¹èµ·æ¥ç®€å•

## ğŸŒ åœ¨çº¿æ¼”ç¤º

ğŸ‘‰ [novel-site-6ba.pages.dev](https://novel-site-6ba.pages.dev)

## âœ¨ åŠŸèƒ½ç‰¹æ€§

**é˜…è¯»ä½“éªŒ**
- ğŸ“± å“åº”å¼è®¾è®¡ï¼Œæ‰‹æœº/å¹³æ¿/ç”µè„‘è‡ªé€‚åº”
- ğŸ¨ 5 ç§ä¸»é¢˜ï¼ˆäº®è‰²/æš—è‰²/æŠ¤çœ¼ç»¿/ç¾Šçš®çº¸/æ·¡è“ï¼‰
- âš™ï¸ é˜…è¯»è®¾ç½®é¢æ¿ï¼šå­—ä½“æ—/å­—å·/è¡Œè·/é¡µé¢å®½åº¦å¯è°ƒ
- ğŸ“– åº•éƒ¨å·¥å…·æ ï¼šä¸Šä¸€ç« /ç›®å½•/è®¾ç½®/ä¹¦ç­¾/ä¸‹ä¸€ç« 
- ğŸ”– ä¹¦ç­¾åŠŸèƒ½ï¼šä»»æ„ç« èŠ‚åŠ ä¹¦ç­¾ï¼Œä¹¦ç±è¯¦æƒ…é¡µæŸ¥çœ‹æ‰€æœ‰ä¹¦ç­¾
- ğŸ“Š é˜…è¯»ç»Ÿè®¡ï¼šè‡ªåŠ¨è®°å½•é˜…è¯»æ—¶é•¿ã€å­—æ•°ã€å¤©æ•°
- âŒ¨ï¸ é”®ç›˜å¿«æ·é”®ï¼šå·¦å³ç®­å¤´ç¿»é¡µã€T åˆ‡ä¸»é¢˜ã€F å…¨å±ã€S è®¾ç½®
- âš¡ é¢„åŠ è½½ä¸‹ä¸€ç« ï¼Œç¿»é¡µç¬é—´åŠ è½½
- ğŸ’¾ é˜…è¯»è¿›åº¦è‡ªåŠ¨è®°å¿†ï¼Œé¦–é¡µæ˜¾ç¤º"ç»§ç»­é˜…è¯»"

**ç®¡ç†åŠŸèƒ½**
- ğŸ“¥ TXT æ™ºèƒ½å¯¼å…¥ï¼ˆè‡ªåŠ¨è¯†åˆ«ç« èŠ‚ï¼Œæ”¯æŒé¢„è§ˆç¼–è¾‘ï¼‰
- ğŸ“¤ TXT å¯¼å‡ºï¼ˆå•ç« /æ•´æœ¬ï¼‰
- ğŸ” ä¹¦å/ä½œè€…æœç´¢ + ä¹¦å†…ç« èŠ‚æœç´¢
- âœ… æ‰¹é‡æ“ä½œï¼šç« èŠ‚å¤šé€‰ã€æ‰¹é‡åˆ é™¤
- ğŸ“ˆ æ•°æ®ç»Ÿè®¡é¢æ¿ï¼šç«™ç‚¹ PV/UVã€ä¹¦ç±é˜…è¯»é‡ã€ç« èŠ‚çƒ­åº¦
- ğŸ’¾ æ•°æ®å¤‡ä»½ä¸æ¢å¤ï¼šä¸€é”®å¯¼å‡º/å¯¼å…¥å…¨ç«™ JSON
- ğŸ”¤ è‡ªå®šä¹‰å­—ä½“ï¼šä¸Šä¼  woff2 å­—ä½“ï¼Œé˜…è¯»é¡µå¯é€‰ç”¨
- ğŸ·ï¸ æ ‡ç­¾åˆ†ç±»ï¼šç»™ä¹¦ç±æ‰“æ ‡ç­¾ï¼ŒæŒ‰æ ‡ç­¾ç­›é€‰
- ğŸ–¼ï¸ å°é¢ç®¡ç†ï¼šä¸Šä¼ è‡ªå®šä¹‰å°é¢å›¾
- ğŸ‘¥ å¤šç®¡ç†å‘˜ï¼šè¶…çº§ç®¡ç†å‘˜ + ç¼–è¾‘è€…è§’è‰²

**å®‰å…¨ä¸æ¶æ„**
- ğŸ” PBKDF2 å¯†ç å“ˆå¸Œ + éšæœº Session Token + IP é™æµ
- ğŸ›¡ï¸ CSP/HSTS/X-Frame-Options ç­‰å®‰å…¨å¤´
- âš™ï¸ ç«™ç‚¹ä¸ªæ€§åŒ–ï¼ˆç«™åã€ç®€ä»‹ã€é¡µè„šè‡ªå®šä¹‰ï¼‰
- ğŸ” SEO å‹å¥½ï¼ˆOpen Graph å…ƒæ ‡ç­¾ï¼‰

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æµè§ˆå™¨     â”‚â”€â”€â”€â”€â–¶â”‚  Cloudflare Pages â”‚â”€â”€â”€â”€â–¶â”‚   D1    â”‚
â”‚  (å‰ç«¯é¡µé¢)  â”‚     â”‚  (Functions API)  â”‚     â”‚ (å…ƒæ•°æ®) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚   R2    â”‚
                      â”‚(ç« èŠ‚å†…å®¹)â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **Pages** â€” æ‰˜ç®¡å‰ç«¯é™æ€æ–‡ä»¶ï¼ˆHTML/CSS/JSï¼‰ï¼Œè‡ªå¸¦å…¨çƒ CDN
- **Functions** â€” åç«¯ APIï¼ˆè®¤è¯ã€CRUDã€ä¸­é—´ä»¶ï¼‰ï¼Œæ–‡ä»¶è·¯å¾„å³ URL è·¯ç”±
- **D1** â€” SQLite æ•°æ®åº“ï¼Œå­˜å‚¨ä¹¦ç±/ç« èŠ‚å…ƒæ•°æ®ã€ç”¨æˆ·ã€ä¼šè¯ã€ç»Ÿè®¡
- **R2** â€” å¯¹è±¡å­˜å‚¨ï¼Œå­˜å‚¨ç« èŠ‚æ­£æ–‡ã€å°é¢å›¾ã€è‡ªå®šä¹‰å­—ä½“

> æ‰“ä¸ªæ¯”æ–¹ï¼šD1 æ˜¯å›¾ä¹¦é¦†çš„ç›®å½•å¡ç‰‡ï¼ˆ"ã€Šæ–—ç ´è‹ç©¹ã€‹ï¼Œå¤©èš•åœŸè±†è‘—ï¼Œå…±1647ç« "ï¼‰ï¼ŒR2 æ˜¯ä¹¦æ¶ä¸Šçš„å®ä½“ä¹¦ï¼ˆæ¯ä¸€ç« çš„å®Œæ•´æ­£æ–‡ï¼‰ã€‚æŸ¥ä¹¦å…ˆç¿»ç›®å½•ï¼ˆD1ï¼‰ï¼Œå†å»ä¹¦æ¶å–ä¹¦ï¼ˆR2ï¼‰ï¼Œå„å¸å…¶èŒã€‚

## ğŸš€ å¿«é€Ÿéƒ¨ç½²ï¼ˆ5 åˆ†é’Ÿï¼‰

ğŸ‘‰ **æ‡’äººéƒ¨ç½²æ•™ç¨‹**ï¼š[LINUX DO å¸–å­](https://linux.do/t/topic/TODO)ï¼ˆä»æ³¨å†Œè´¦å·åˆ°éƒ¨ç½²ä¸Šçº¿ï¼Œæ¯ä¸€æ­¥éƒ½æœ‰è¯´æ˜ï¼‰

ç®€å•æ¥è¯´å°±æ˜¯ï¼šæ³¨å†Œ CF è´¦å· â†’ è£… Node.js å’Œ Wrangler â†’ å…‹éš†ä»“åº“ â†’ åˆ›å»º D1 å’Œ R2 â†’ æ”¹é…ç½® â†’ éƒ¨ç½²ã€‚å‡ æ¡å‘½ä»¤çš„äº‹ã€‚

> âš ï¸ R2 éœ€è¦å…ˆç»‘å®šæ”¯ä»˜æ–¹å¼ï¼ˆPayPal æˆ–å¤–å¸ä¿¡ç”¨å¡ï¼‰æ‰èƒ½å¼€é€šï¼Œ**ä¸ä¼šæ‰£è´¹**ï¼Œåªæ˜¯èº«ä»½éªŒè¯ã€‚æ¨èç”¨ PayPalï¼Œå›½å†…é“¶è¡Œå¡å’Œæ‰‹æœºå·å³å¯æ³¨å†Œã€‚

## ğŸ“– æ·±å…¥äº†è§£

### ä¸ºä»€ä¹ˆç”¨ D1 + R2 ä¸¤ä¸ªå­˜å‚¨ï¼Ÿ

ç›´æ¥å…¨æ”¾æ•°æ®åº“ä¸è¡Œå—ï¼Ÿå¯ä»¥ï¼Œä½†ä¸å¥½ã€‚

- **D1**ï¼ˆSQLiteï¼‰æ“…é•¿å­˜ç»“æ„åŒ–çš„å°æ•°æ®â€”â€”ä¹¦åã€ä½œè€…ã€ç« èŠ‚æ ‡é¢˜ã€å­—æ•°ã€åˆ›å»ºæ—¶é—´ã€‚æŸ¥è¯¢å¿«ï¼Œæ”¯æŒ SQL
- **R2**ï¼ˆå¯¹è±¡å­˜å‚¨ï¼‰æ“…é•¿å­˜å¤§å—éç»“æ„åŒ–æ•°æ®â€”â€”å°è¯´æ­£æ–‡åŠ¨è¾„å‡ åƒä¸Šä¸‡å­—ï¼Œæ”¾æ•°æ®åº“é‡Œæ—¢æµªè´¹åˆæ…¢

è¯»å–ç« èŠ‚æ—¶çš„æµç¨‹ï¼šå…ˆä» D1 æŸ¥ç« èŠ‚å…ƒæ•°æ®ï¼ˆæ‹¿åˆ° `content_key`ï¼‰ï¼Œå†ç”¨è¿™ä¸ª key å» R2 å–æ­£æ–‡ã€‚å†™å…¥ç« èŠ‚æ—¶åè¿‡æ¥ï¼šå…ˆåœ¨ D1 æ’å…¥è®°å½•æ‹¿åˆ°è‡ªå¢ IDï¼Œæ‹¼å‡º R2 è·¯å¾„ï¼Œä¸Šä¼ æ­£æ–‡åˆ° R2ï¼Œæœ€åå›å†™ `content_key` åˆ° D1ã€‚

### é¡¹ç›®ç»“æ„

```
novel-site/
â”œâ”€â”€ index.html              # é¦–é¡µï¼ˆä¹¦æ¶ + é˜…è¯»ç»Ÿè®¡ï¼‰
â”œâ”€â”€ book.html               # ä¹¦ç±è¯¦æƒ…ï¼ˆç« èŠ‚åˆ—è¡¨ + ä¹¦ç­¾ï¼‰
â”œâ”€â”€ read.html               # é˜…è¯»é¡µé¢ï¼ˆè®¾ç½®é¢æ¿ + å¿«æ·é”®ï¼‰
â”œâ”€â”€ admin.html              # ç®¡ç†åå°ï¼ˆç»Ÿè®¡ + æ‰¹é‡æ“ä½œ + å­—ä½“ç®¡ç†ï¼‰
â”œâ”€â”€ 404.html                # 404 é¡µé¢
â”œâ”€â”€ style.css               # å…¨å±€æ ·å¼ï¼ˆ5 ä¸»é¢˜ + å“åº”å¼ï¼‰
â”œâ”€â”€ schema.sql              # æ•°æ®åº“å»ºè¡¨è¯­å¥
â”œâ”€â”€ wrangler.toml           # Cloudflare é…ç½®
â”œâ”€â”€ migrations/             # æ•°æ®åº“è¿ç§»è„šæœ¬
â”‚   â””â”€â”€ 001_stats_and_roles.sql  # è®¿é—®ç»Ÿè®¡ + å¤šç®¡ç†å‘˜è§’è‰²
â””â”€â”€ functions/              # åç«¯ API
    â”œâ”€â”€ _middleware.js       # å…¬å…±ä¸­é—´ä»¶ï¼ˆå®‰å…¨å¤´ã€CORSã€é”™è¯¯å¤„ç†ï¼‰
    â””â”€â”€ api/
        â”œâ”€â”€ _utils.js       # å·¥å…·å‡½æ•°ï¼ˆè®¤è¯ã€å¯†ç å“ˆå¸Œã€æ ¡éªŒï¼‰
        â”œâ”€â”€ auth.js         # è®¤è¯ï¼ˆç™»å½•/ç™»å‡º/æ”¹å¯†ç ï¼‰
        â”œâ”€â”€ books.js        # ä¹¦ç±åˆ—è¡¨
        â”œâ”€â”€ search.js       # æœç´¢
        â”œâ”€â”€ settings.js     # ç«™ç‚¹è®¾ç½®
        â”œâ”€â”€ fonts.js        # è‡ªå®šä¹‰å­—ä½“åˆ—è¡¨
        â”œâ”€â”€ tags.js         # æ ‡ç­¾åˆ—è¡¨
        â”œâ”€â”€ books/
        â”‚   â””â”€â”€ [id].js     # ä¹¦ç±è¯¦æƒ… + ç« èŠ‚åˆ—è¡¨
        â”œâ”€â”€ chapters/
        â”‚   â””â”€â”€ [id].js     # ç« èŠ‚å†…å®¹ï¼ˆD1 å…ƒæ•°æ® + R2 æ­£æ–‡ï¼‰
        â”œâ”€â”€ covers/
        â”‚   â””â”€â”€ [id].js     # å°é¢å›¾ serve
        â”œâ”€â”€ fonts/
        â”‚   â””â”€â”€ [name].js   # å­—ä½“æ–‡ä»¶ serve
        â””â”€â”€ admin/          # ç®¡ç† APIï¼ˆéœ€ç™»å½•ï¼‰
            â”œâ”€â”€ books.js    # åˆ›å»ºä¹¦ç±
            â”œâ”€â”€ settings.js # ç«™ç‚¹è®¾ç½®
            â”œâ”€â”€ fonts.js    # å­—ä½“ä¸Šä¼ /åˆ é™¤
            â”œâ”€â”€ tags.js     # æ ‡ç­¾ç®¡ç†
            â”œâ”€â”€ covers.js   # å°é¢ä¸Šä¼ 
            â”œâ”€â”€ stats.js    # è®¿é—®ç»Ÿè®¡
            â”œâ”€â”€ users.js    # å¤šç®¡ç†å‘˜ç®¡ç†
            â”œâ”€â”€ book-tags.js # ä¹¦ç±æ ‡ç­¾å…³è”
            â”œâ”€â”€ books/
            â”‚   â””â”€â”€ [id].js # ç¼–è¾‘/åˆ é™¤ä¹¦ç±
            â”œâ”€â”€ chapters.js # åˆ›å»ºç« èŠ‚
            â””â”€â”€ chapters/
                â”œâ”€â”€ [id].js # ç¼–è¾‘/åˆ é™¤ç« èŠ‚
                â””â”€â”€ swap.js # ç« èŠ‚æ’åº
```

> `functions/` ç›®å½•æ˜¯ Pages Functions çš„çº¦å®šâ€”â€”æ–‡ä»¶è·¯å¾„å³ URL è·¯ç”±ã€‚`functions/api/books.js` â†’ `/api/books`ï¼Œ`functions/api/books/[id].js` â†’ `/api/books/123`ã€‚ä»¥ `_` å¼€å¤´çš„æ–‡ä»¶ä¸ä¼šæˆä¸ºè·¯ç”±ã€‚

### æ•°æ®åº“è®¾è®¡

å®Œæ•´å»ºè¡¨è¯­å¥è§ `schema.sql`ï¼Œæ ¸å¿ƒè¡¨ç»“æ„ï¼š

```sql
-- ä¹¦ç±è¡¨ï¼šå­˜å…ƒæ•°æ®ï¼Œæ­£æ–‡ä¸åœ¨è¿™é‡Œ
CREATE TABLE IF NOT EXISTS books (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  title TEXT NOT NULL,
  description TEXT DEFAULT '',
  author TEXT DEFAULT '',
  cover_key TEXT DEFAULT '',
  created_at TEXT DEFAULT (datetime('now')),
  updated_at TEXT DEFAULT (datetime('now'))
);

-- ç« èŠ‚è¡¨ï¼šcontent_key æŒ‡å‘ R2 ä¸­çš„æ­£æ–‡å¯¹è±¡
CREATE TABLE IF NOT EXISTS chapters (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  book_id INTEGER NOT NULL,
  title TEXT NOT NULL,
  sort_order INTEGER NOT NULL,
  word_count INTEGER DEFAULT 0,
  content_key TEXT NOT NULL,        -- R2 è·¯å¾„ï¼Œå¦‚ novels/books/1/chapters/42.txt
  created_at TEXT DEFAULT (datetime('now')),
  updated_at TEXT DEFAULT (datetime('now')),
  FOREIGN KEY (book_id) REFERENCES books(id)
);

-- ç®¡ç†å‘˜è´¦å·ï¼šå¯†ç ç”¨ PBKDF2 å“ˆå¸Œå­˜å‚¨
CREATE TABLE IF NOT EXISTS admin_users (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  username TEXT UNIQUE NOT NULL,
  password_hash TEXT NOT NULL,
  role TEXT DEFAULT 'editor',       -- super_admin æˆ– editor
  created_at TEXT DEFAULT (datetime('now')),
  updated_at TEXT DEFAULT (datetime('now'))
);
```

å…¶ä»–è¡¨ï¼š

```
admin_sessions  -- ç™»å½•ä¼šè¯ï¼ˆéšæœº tokenï¼Œ7 å¤©è¿‡æœŸï¼Œæ•°æ®åº“åªå­˜ SHA-256 å“ˆå¸Œï¼‰
site_settings   -- ç«™ç‚¹é…ç½®ï¼ˆç«™åã€ç®€ä»‹ã€é¡µè„šï¼‰
auth_attempts   -- ç™»å½•é™æµï¼ˆIP å“ˆå¸Œ + å¤±è´¥è®¡æ•°ï¼Œ5 æ¬¡é”å®š 10 åˆ†é’Ÿï¼‰
site_visits     -- ç«™ç‚¹æ—¥ PV/UV
daily_visitors  -- UV å»é‡è¾…åŠ©ï¼ˆIP å“ˆå¸Œé›†åˆï¼‰
book_stats      -- ä¹¦ç±æ—¥é˜…è¯»é‡
chapter_stats   -- ç« èŠ‚ç´¯è®¡é˜…è¯»é‡
```

å…³é”®è®¾è®¡å†³ç­–ï¼š

- **D1 + R2 åˆ†å·¥**ï¼šç« èŠ‚æ­£æ–‡å­˜ R2ï¼ˆå¤§å—æ–‡æœ¬ï¼‰ï¼Œå…ƒæ•°æ®å­˜ D1ï¼ˆç»“æ„åŒ–æŸ¥è¯¢ï¼‰ã€‚D1 çš„ `content_key` å­—æ®µæŒ‡å‘ R2 ä¸­çš„å¯¹è±¡è·¯å¾„ï¼ˆå¦‚ `novels/books/1/chapters/42.txt`ï¼‰
- **å¯†ç ä¸å­˜æ˜æ–‡**ï¼šç”¨ PBKDF2ï¼ˆ100,000 æ¬¡è¿­ä»£ + 16 å­—èŠ‚éšæœºç›ï¼‰å“ˆå¸Œåå­˜å‚¨
- **Session Token ä¸å¯†ç è§£è€¦**ï¼šç™»å½•æˆåŠŸåç”Ÿæˆ 32 å­—èŠ‚éšæœº tokenï¼Œæ•°æ®åº“åªå­˜ SHA-256 å“ˆå¸Œ
- **IP ä»¥å“ˆå¸Œå­˜å‚¨**ï¼š`auth_attempts` è¡¨ä¸­çš„ IP ç”¨ SHA-256 å“ˆå¸Œï¼Œä¸å­˜åŸå§‹ IP
- **å…ˆ DB å R2**ï¼šåˆ›å»ºç« èŠ‚æ—¶å…ˆæ’ D1 æ‹¿åˆ°è‡ªå¢ IDï¼Œå†æ‹¼ R2 è·¯å¾„ä¸Šä¼ æ­£æ–‡ï¼Œæœ€åå›å†™ `content_key`

### å®‰å…¨è®¾è®¡

**ä¸­é—´ä»¶ï¼ˆ`functions/_middleware.js`ï¼‰**

æ‰€æœ‰è¯·æ±‚çš„"å®‰å…¨é—¨å«"ï¼Œè´Ÿè´£ï¼š
- CORS æ§åˆ¶ï¼šå…¬å¼€ API å…è®¸è·¨åŸŸï¼ˆ`*`ï¼‰ï¼Œç®¡ç† API ä¸è¿”å› CORS å¤´ï¼ˆä»…åŒæºè®¿é—®ï¼‰
- è¯·æ±‚å¤§å°é™åˆ¶ï¼šè¶…è¿‡ 10MB ç›´æ¥æ‹’ç»ï¼ˆHTTP 413ï¼‰
- é”™è¯¯å…œåº•ï¼šåç«¯å¼‚å¸¸è¿”å› 500ï¼Œä¸æš´éœ²é”™è¯¯è¯¦æƒ…
- å®‰å…¨å“åº”å¤´ï¼š

| å¤´ | ä½œç”¨ |
|---|---|
| `Content-Security-Policy` | é™åˆ¶èµ„æºåŠ è½½æ¥æºï¼Œé˜² XSS |
| `Strict-Transport-Security` | å¼ºåˆ¶ HTTPS |
| `X-Frame-Options: DENY` | é˜²ç‚¹å‡»åŠ«æŒ |
| `X-Content-Type-Options: nosniff` | é˜² MIME å—…æ¢ |
| `Referrer-Policy` | æ§åˆ¶ Referer æ³„éœ² |
| `Permissions-Policy` | ç¦ç”¨æ‘„åƒå¤´/éº¦å…‹é£/å®šä½ |

**è®¤è¯æµç¨‹**

1. ç”¨æˆ·æäº¤å¯†ç  â†’ PBKDF2 å“ˆå¸Œåä¸æ•°æ®åº“æ¯”å¯¹
2. éªŒè¯é€šè¿‡ â†’ ç”Ÿæˆ 32 å­—èŠ‚éšæœº Session Token â†’ SHA-256 å“ˆå¸Œåå­˜å…¥ `admin_sessions`
3. åç»­è¯·æ±‚å¸¦ `Authorization: Bearer <token>` â†’ å“ˆå¸ŒåæŸ¥è¡¨éªŒè¯
4. é¦–æ¬¡ç™»å½•è‡ªåŠ¨åˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼ˆå¯†ç æ¥è‡ªç¯å¢ƒå˜é‡ `ADMIN_PASSWORD`ï¼‰
5. åŒä¸€ IP è¿ç»­ 5 æ¬¡ç™»å½•å¤±è´¥ â†’ é”å®š 10 åˆ†é’Ÿ

> å‰ç«¯ token å­˜åœ¨ `sessionStorage`ï¼ˆå…³é—­æ ‡ç­¾é¡µè‡ªåŠ¨æ¸…é™¤ï¼‰ï¼Œæ¯” `localStorage` æ›´å®‰å…¨ã€‚

**å‰ç«¯é˜²æŠ¤**

- æ­£æ–‡ç”¨ `textContent` æ¸²æŸ“ï¼ˆä¸æ˜¯ `innerHTML`ï¼‰ï¼Œé˜² XSS
- æ‰€æœ‰ç”¨æˆ·è¾“å…¥æ¸²æŸ“å‰ `escapeHtml()` è½¬ä¹‰
- æ‰€æœ‰ SQL æŸ¥è¯¢ä½¿ç”¨å‚æ•°åŒ–ç»‘å®šï¼Œé˜²æ³¨å…¥
- æ­£æ–‡æ¢è¡Œç”¨ CSS `white-space: pre-wrap` å¤„ç†

### å‰ç«¯è®¾è®¡è¦ç‚¹

- **é›¶æ¡†æ¶**ï¼šçº¯ HTML/CSS/JSï¼Œä¸éœ€è¦æ„å»ºæ­¥éª¤ï¼Œæ”¹å®Œåˆ·æ–°å³å¯
- **é˜…è¯»åŒºå®½åº¦**ï¼šæœ€å¤§ 800pxï¼Œä¸€è¡Œä¸è¶…è¿‡ 40 ä¸ªæ±‰å­—ï¼Œé¿å…çœ¼ç›è·Ÿä¸¢
- **æ­£æ–‡å­—ä½“**ï¼šè¡¬çº¿ä½“ï¼ˆNoto Serif SCï¼‰ï¼Œè¡Œé«˜ 1.8 å€ï¼Œé•¿æ–‡é˜…è¯»æœ€ä½³å®è·µ
- **ä¹¦æ¶å¸ƒå±€**ï¼šCSS Grid è‡ªé€‚åº”ï¼Œæ‰‹æœºä¸€åˆ—ã€å¹³æ¿ä¸¤åˆ—ã€ç”µè„‘ä¸‰åˆ—
- **ä¸»é¢˜ç³»ç»Ÿ**ï¼š5 ç§ä¸»é¢˜é€šè¿‡ CSS å˜é‡åˆ‡æ¢ï¼Œç”¨æˆ·åå¥½å­˜ `localStorage`

## ğŸ“Š Cloudflare å…è´¹é¢åº¦

| æœåŠ¡ | å…è´¹é¢åº¦ | å°è¯´ç«™å®é™…ç”¨é‡ | å¤Ÿç”¨å— |
|------|---------|--------------|--------|
| Pages è¯·æ±‚ | æ— é™ | éšä¾¿ç”¨ | âœ… |
| Functions è¯·æ±‚ | 10 ä¸‡æ¬¡/å¤© | æ¯æ¬¡ç¿»é¡µ 1 æ¬¡ï¼Œæ—¥è¯» 1000 é¡µæ‰ 1000 æ¬¡ | âœ… |
| D1 è¯»å– | 500 ä¸‡æ¬¡/å¤© | æ¯ä¸ª API è°ƒ 1-3 æ¬¡æŸ¥è¯¢ | âœ… |
| D1 å†™å…¥ | 10 ä¸‡æ¬¡/å¤© | åªæœ‰ç®¡ç†å‘˜æ·»åŠ ç« èŠ‚æ‰å†™ | âœ… |
| D1 å­˜å‚¨ | 5GB | çº¯æ–‡æœ¬å…ƒæ•°æ®ï¼Œ1 ä¸‡æœ¬ä¹¦ç”¨ä¸åˆ° 100MB | âœ… |
| R2 å­˜å‚¨ | 10GB | ä¸€æœ¬ 50 ä¸‡å­—çº¦ 1MBï¼Œèƒ½å­˜ 1 ä¸‡æœ¬ | âœ… |
| R2 è¯»å– | 1000 ä¸‡æ¬¡/æœˆ | æ¯æ¬¡é˜…è¯»è¯» 1 æ¬¡ R2 | âœ… |
| R2 å†™å…¥ | 100 ä¸‡æ¬¡/æœˆ | åªæœ‰æ·»åŠ ç« èŠ‚æ‰å†™ | âœ… |

> ä¸ªäººä½¿ç”¨å®Œå…¨å¤Ÿç”¨ï¼Œå³ä½¿å­˜å‡ ç™¾æœ¬å°è¯´ä¹Ÿä¸ä¼šè¶…å‡ºå…è´¹é¢åº¦ã€‚é™¤éæ—¥æ´»è¿‡ä¸‡ï¼Œå¦åˆ™å…è´¹é¢åº¦æ ¹æœ¬ç”¨ä¸å®Œã€‚

## ğŸ› ï¸ æœ¬åœ°å¼€å‘

```bash
wrangler pages dev . --port 3355 \
  --d1 DB=<your-database-id> \
  --r2 R2=novel-storage \
  --binding ADMIN_PASSWORD=your_password
```

æœ¬åœ°å¼€å‘æœåŠ¡å™¨æ¨¡æ‹Ÿå®Œæ•´çš„ Pages + Functions + D1 + R2 ç¯å¢ƒã€‚æœ¬åœ°æ•°æ®ä¸äº‘ç«¯éš”ç¦»ã€‚

é¦–æ¬¡è®¿é—® `/admin.html`ï¼Œç”¨ `admin` / ä½ è®¾ç½®çš„å¯†ç ç™»å½•ã€‚

### æ•°æ®åº“è¿ç§»

é¡¹ç›®ä½¿ç”¨ `migrations/` ç›®å½•ç®¡ç†æ•°æ®åº“å˜æ›´ã€‚å¦‚æœä½ ä»æ—©æœŸç‰ˆæœ¬å‡çº§ï¼Œéœ€è¦æ‰§è¡Œè¿ç§»è„šæœ¬ï¼š

```bash
wrangler d1 execute novel-db --file migrations/001_stats_and_roles.sql --remote
```

æ–°éƒ¨ç½²ä¸éœ€è¦æ‰‹åŠ¨æ‰§è¡Œè¿ç§»ï¼Œ`schema.sql` å·²åŒ…å«æ‰€æœ‰è¡¨ç»“æ„ã€‚

## ğŸ“ ä½¿ç”¨è¯´æ˜

1. è®¿é—® `/admin.html` ç™»å½•ç®¡ç†åå°
2. åˆ›å»ºä¹¦ç±ï¼ˆå¡«å†™ä¹¦åã€ä½œè€…ã€ç®€ä»‹ï¼‰
3. æ·»åŠ ç« èŠ‚ï¼ˆæ‰‹åŠ¨è¾“å…¥æˆ– TXT å¯¼å…¥ï¼‰
4. è®¿é—®é¦–é¡µæŸ¥çœ‹ä¹¦æ¶ï¼Œç‚¹å‡»é˜…è¯»

### TXT å¯¼å…¥

æ”¯æŒè‡ªåŠ¨è¯†åˆ«ç« èŠ‚æ ‡é¢˜ï¼š
- `ç¬¬ä¸€ç« `ã€`ç¬¬1ç« `ã€`Chapter 1`ã€`Part I`
- `åºç« `ã€`æ¥”å­`ã€`ç•ªå¤–`ã€`ç»ˆç« `ã€`å¤§ç»“å±€` ç­‰
- æ”¯æŒ UTF-8ã€GBKã€UTF-16 ç¼–ç è‡ªåŠ¨æ£€æµ‹

å¯¼å…¥å‰å¯é¢„è§ˆè¯†åˆ«ç»“æœï¼Œæ”¯æŒæ‰‹åŠ¨ç¼–è¾‘ç« èŠ‚æ‹†åˆ†ã€‚

### æ•°æ®å¤‡ä»½

ç®¡ç†åå°æ”¯æŒä¸€é”®å¯¼å‡ºå…¨ç«™æ•°æ®ä¸º JSON æ–‡ä»¶ï¼ŒåŒ…å«æ‰€æœ‰ä¹¦ç±ã€ç« èŠ‚ã€è®¾ç½®ã€‚å¯åœ¨æ–°ç«™ç‚¹ä¸€é”®å¯¼å…¥æ¢å¤ã€‚

## ğŸ”® æ‰©å±•æ€è·¯

è¿™å¥—æ¶æ„ï¼ˆPages + Functions + D1 + R2ï¼‰æ˜¯é€šç”¨çš„å…¨æ ˆæ–¹æ¡ˆï¼Œå¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šæ‰©å±•ï¼š

- **è‡ªå®šä¹‰åŸŸå** â€” CF Pages æ”¯æŒç»‘å®šåŸŸåï¼Œåœ¨ Dashboard â†’ Pages â†’ Custom domains æ·»åŠ ï¼ŒSSL è‡ªåŠ¨é…ç½®
- **Markdown æ¸²æŸ“** â€” å¼•å…¥è½»é‡ Markdown åº“ï¼ˆå¦‚ marked.jsï¼‰ï¼Œè®©æ­£æ–‡æ”¯æŒå¯Œæ–‡æœ¬æ ¼å¼ï¼ˆæ³¨æ„åšå¥½ XSS è¿‡æ»¤ï¼‰
- **EPUB å¯¼å…¥** â€” è§£æ EPUB æ ¼å¼ç”µå­ä¹¦ï¼Œè‡ªåŠ¨æå–ç« èŠ‚å’Œå…ƒæ•°æ®
- **é˜…è¯»è¿›åº¦åŒæ­¥** â€” å½“å‰è¿›åº¦å­˜åœ¨ `localStorage`ï¼Œå¯ä»¥æ‰©å±•ä¸ºæœåŠ¡ç«¯å­˜å‚¨ï¼Œå®ç°è·¨è®¾å¤‡åŒæ­¥
- **å…¨æ–‡æœç´¢** â€” D1 æ”¯æŒ `LIKE` æŸ¥è¯¢ï¼Œå¯åœ¨ D1 é¢å¤–å­˜ä¸€ä»½æ­£æ–‡æ‘˜è¦ç”¨äºæœç´¢
- **å…¶ä»–åº”ç”¨** â€” åŒæ ·çš„æ¶æ„å¯ä»¥æ­åšå®¢ï¼ˆæ–‡ç« å­˜ R2ï¼‰ã€å›¾åºŠï¼ˆå›¾ç‰‡å­˜ R2ï¼‰ã€ç½‘ç›˜ï¼ˆæ–‡ä»¶å­˜ R2ï¼‰ç­‰ä»»ä½•éœ€è¦"æ•°æ®åº“ + æ–‡ä»¶å­˜å‚¨"çš„å°é¡¹ç›®

> CF çš„å…è´¹å¥—é¤å°±æ˜¯ä¸ªäººå¼€å‘è€…çš„ç¦éŸ³ã€‚ä»¥åæ¯æ¬¡ä¿®æ”¹ä»£ç ï¼Œåªéœ€è¦å†è·‘ä¸€æ¬¡ `wrangler pages deploy .` å°±èƒ½æ›´æ–°çº¿ä¸Šç‰ˆæœ¬ã€‚CF Pages ä¼šè‡ªåŠ¨ä¿ç•™å†å²ç‰ˆæœ¬ï¼Œæç ¸äº†å¯ä»¥ä¸€é”®å›æ»šã€‚

## ğŸ“ˆ Star History

[![Star History Chart](https://api.star-history.com/svg?repos=xingzihai/novel-site&type=Date)](https://star-history.com/#xingzihai/novel-site&Date)

## ğŸ“„ License

[AGPL-3.0](LICENSE)

## ğŸ¤ è‡´è°¢ä¸è´¡çŒ®

æœ¬é¡¹ç›®é¦–å‘äº LINUX DO ç¤¾åŒºã€‚

æ¬¢è¿æ [Issue](https://github.com/xingzihai/novel-site/issues) å’Œ [Pull Request](https://github.com/xingzihai/novel-site/pulls)ï¼æ— è®ºæ˜¯ bug åé¦ˆã€åŠŸèƒ½å»ºè®®è¿˜æ˜¯ä»£ç è´¡çŒ®ï¼Œéƒ½éå¸¸æ„Ÿè°¢ã€‚
