<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>管理后台</title>
  <link rel="stylesheet" href="/assets/css/base.css">
  <link rel="stylesheet" href="/assets/css/theme.css">
  <link rel="stylesheet" href="/assets/css/components.css">
  <link rel="stylesheet" href="/assets/css/pages/admin.css">
  <link rel="stylesheet" href="/assets/css/responsive.css">
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js" integrity="sha384-+mbV2IY1Zk/X1p/nWllGySJSUN8uMs+gUAN10Or95UBH0fpj6GfKgPmgC5EXieXG" crossorigin="anonymous"></script>
</head>
<body>
  <div class="navbar">
    <h1><a href="/">📚 我的书架</a></h1>
    <nav>
      <a href="/">返回书架</a>
      <span id="user-info" style="display:none;font-size:13px;color:var(--text-light)"></span>
      <button class="theme-toggle" title="切换主题">🌙</button>
    </nav>
  </div>
  <div class="container">

    <!-- 登录界面 -->
    <div id="login-panel">
      <div class="admin-section" style="max-width:400px;margin:60px auto">
        <h3>🔐 管理员登录</h3>
        <div class="form-group">
          <label>用户名</label>
          <input type="text" id="login-user" placeholder="admin" value="admin">
        </div>
        <div class="form-group">
          <label>密码</label>
          <input type="password" id="login-pass" placeholder="输入管理密码">
        </div>
        <button class="btn" id="login-btn" style="width:100%">登录</button>
        <div id="login-msg" style="margin-top:8px"></div>
        <div style="margin-top:16px;text-align:center">
          <div id="github-login-section" style="display:none">
            <div style="color:var(--text-light);font-size:13px;margin-bottom:8px">— 或 —</div>
            <button class="btn" id="github-login-btn" style="width:100%;background:#24292e;color:#fff;border:none;padding:10px;border-radius:var(--radius);cursor:pointer;font-size:14px">
              <svg style="vertical-align:middle;margin-right:6px" width="18" height="18" viewBox="0 0 16 16" fill="white"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
              GitHub 登录（Demo 体验）
            </button>
            <div style="font-size:12px;color:var(--text-light);margin-top:4px">首次登录自动注册为演示管理员</div>
          </div>
        </div>
      </div>
    </div>

    <!-- 管理面板（登录后显示） -->
    <div id="admin-panel" style="display:none">

      <!-- 数据概览 -->
      <div class="admin-section" id="stats-panel">
        <h3>📊 数据概览</h3>
        <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px" id="stats-grid">
          <div style="text-align:center;padding:16px;background:var(--bg);border-radius:var(--radius)">
            <div style="font-size:28px;font-weight:700;color:var(--accent)" id="stat-books">-</div>
            <div style="font-size:13px;color:var(--text-light)">书籍</div>
          </div>
          <div style="text-align:center;padding:16px;background:var(--bg);border-radius:var(--radius)">
            <div style="font-size:28px;font-weight:700;color:var(--accent)" id="stat-chapters">-</div>
            <div style="font-size:13px;color:var(--text-light)">章节</div>
          </div>
          <div style="text-align:center;padding:16px;background:var(--bg);border-radius:var(--radius)">
            <div style="font-size:28px;font-weight:700;color:var(--accent)" id="stat-words">-</div>
            <div style="font-size:13px;color:var(--text-light)">总字数</div>
          </div>
          <div style="text-align:center;padding:16px;background:var(--bg);border-radius:var(--radius)">
            <div style="font-size:28px;font-weight:700;color:var(--accent)" id="stat-pv">-</div>
            <div style="font-size:13px;color:var(--text-light)">今日访问</div>
          </div>
          <div style="text-align:center;padding:16px;background:var(--bg);border-radius:var(--radius)">
            <div style="font-size:28px;font-weight:700;color:var(--accent)" id="stat-uv">-</div>
            <div style="font-size:13px;color:var(--text-light)">今日访客</div>
          </div>
          <div style="text-align:center;padding:16px;background:var(--bg);border-radius:var(--radius)">
            <div style="font-size:28px;font-weight:700;color:var(--accent)" id="stat-total-pv">-</div>
            <div style="font-size:13px;color:var(--text-light)">累计访问</div>
          </div>
        </div>
        <!-- 热门书籍 -->
        <div id="hot-books" style="margin-top:16px"></div>
      </div>

      <!-- 存储空间 -->
      <div class="admin-section" id="storage-panel">
        <h3>🧮 存储空间</h3>
        <div style="display:flex;flex-wrap:wrap;gap:16px;align-items:flex-end">
          <div>
            <div style="font-size:12px;color:var(--text-light)">已用</div>
            <div style="font-size:20px;font-weight:700" id="storage-used">-</div>
          </div>
          <div>
            <div style="font-size:12px;color:var(--text-light)">对象数</div>
            <div style="font-size:20px;font-weight:700" id="storage-objects">-</div>
          </div>
          <div>
            <div style="font-size:12px;color:var(--text-light)">剩余</div>
            <div style="font-size:20px;font-weight:700" id="storage-remaining">-</div>
          </div>
        </div>
        <div id="storage-breakdown" style="margin-top:10px;font-size:13px;color:var(--text-light)"></div>

        <div class="super-admin-only" style="display:none;margin-top:14px;padding-top:12px;border-top:1px solid var(--border)">
          <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:end">
            <div>
              <label style="font-size:12px;color:var(--text-light)">配额上限（GB，可空）</label>
              <input type="number" id="storage-limit-gb" min="0" step="0.1" placeholder="例如 10" style="width:160px">
            </div>
            <button class="btn btn-sm" id="save-storage-limit-btn">保存配额</button>
            <button class="btn btn-sm btn-danger" id="clear-storage-limit-btn">清除</button>
          </div>
          <div id="storage-limit-msg" style="margin-top:8px"></div>
        </div>

        <div style="margin-top:16px;padding-top:12px;border-top:1px solid var(--border)">
          <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:end">
            <div style="flex:1;min-width:220px">
              <label style="font-size:12px;color:var(--text-light)">对象前缀过滤（可选）</label>
              <input type="text" id="storage-prefix" placeholder="例如 sources/books/1/" maxlength="200">
            </div>
            <button class="btn btn-sm" id="storage-refresh-btn">刷新明细</button>
          </div>
          <ul class="admin-list" id="storage-objects-list" style="margin-top:10px"></ul>
          <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
            <button class="btn btn-sm" id="storage-load-more" style="display:none">加载更多</button>
            <span id="storage-objects-msg" style="font-size:12px;color:var(--text-light)"></span>
          </div>
        </div>
      </div>

      <!-- 账号管理 -->
      <div class="admin-section">
        <h3>👤 账号管理</h3>
        <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px">
          <span>当前用户：<strong id="current-user"></strong></span>
          <a href="#" id="change-password-link" style="font-size:13px">修改密码</a>
          <a href="#" id="logout-link" style="font-size:13px;color:var(--danger,#e74c3c)">退出登录</a>
        </div>
        <div id="pwd-form" style="display:none">
          <div class="form-group">
            <label>旧密码</label>
            <input type="password" id="old-pwd" placeholder="输入当前密码">
          </div>
          <div class="form-group">
            <label>新密码（至少8位，需包含字母和数字）</label>
            <input type="password" id="new-pwd" placeholder="输入新密码">
          </div>
          <div class="form-group">
            <label>确认新密码</label>
            <input type="password" id="new-pwd2" placeholder="再次输入新密码">
          </div>
          <button class="btn" id="change-password-btn">确认修改</button>
          <button class="btn btn-sm" id="change-password-cancel-btn" style="margin-left:8px">取消</button>
          <div id="pwd-msg" style="margin-top:8px"></div>
        </div>
      </div>

      <!-- 站点设置 -->
      <div class="admin-section super-admin-only" style="display:none">
        <h3>⚙️ 站点设置</h3>
        <div class="form-group">
          <label>站点名称</label>
          <input type="text" id="set-site-name" placeholder="如：xingzihai的书架" maxlength="100">
        </div>
        <div class="form-group">
          <label>站点描述</label>
          <input type="text" id="set-site-desc" placeholder="一句话介绍你的小说站" maxlength="200">
        </div>
        <div class="form-group">
          <label>页脚文字</label>
          <input type="text" id="set-footer" placeholder="如：Powered by Cloudflare" maxlength="200">
        </div>
        <button class="btn" id="save-settings-btn">保存设置</button>
        <div id="settings-msg"></div>

        <!-- GitHub OAuth 配置 -->
        <div style="margin-top:24px;padding-top:16px;border-top:1px solid var(--border)">
          <h4 style="margin:0 0 12px">🐙 Demo 注册（GitHub 登录）</h4>
          <div class="form-group">
            <label>
              <input type="checkbox" id="gh-oauth-enabled"> 启用 GitHub 登录注册
            </label>
            <div style="font-size:12px;color:var(--text-light);margin-top:2px">开启后，登录页会显示"GitHub 登录"按钮，新用户自动注册为演示管理员</div>
          </div>
          <div id="gh-oauth-config" style="display:none">
            <div style="background:var(--bg);padding:10px;border-radius:var(--radius);margin-bottom:12px;font-size:13px;color:var(--text-light)">
              <strong>配置步骤：</strong><br>
              1. 打开 <a href="https://github.com/settings/developers" target="_blank" style="color:var(--primary)">GitHub Developer Settings</a><br>
              2. 点击 OAuth Apps → New OAuth App<br>
              3. Homepage URL 填：<code id="gh-homepage-url"></code><br>
              4. Callback URL 填：<code id="gh-callback-url"></code><br>
              5. 创建后把 Client ID 和 Client Secret 填到下面
            </div>
            <div class="form-group">
              <label>Client ID</label>
              <input type="text" id="gh-client-id" placeholder="Ov23li..." maxlength="100">
            </div>
            <div class="form-group">
              <label>Client Secret <span id="gh-secret-status" style="font-size:12px"></span></label>
              <input type="password" id="gh-client-secret" placeholder="留空则保持原值不变" maxlength="200">
            </div>
            <button class="btn" id="save-github-config-btn">保存 GitHub 配置</button>
            <div id="gh-config-msg" style="margin-top:8px"></div>
          </div>
        </div>
      </div>

      <!-- TXT导入 -->
      <div class="admin-section">
        <h3>📥 TXT 导入</h3>
        <div class="form-group">
          <label>导入方式</label>
          <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
            <label style="display:flex;align-items:center;gap:4px;font-size:14px;cursor:pointer">
              <input type="radio" name="txt-import-mode" value="existing" checked> 导入到已有书籍
            </label>
            <label style="display:flex;align-items:center;gap:4px;font-size:14px;cursor:pointer">
              <input type="radio" name="txt-import-mode" value="new"> 创建新书并导入
            </label>
          </div>
          <div style="font-size:12px;color:var(--text-light);margin-top:6px">导入会保留源 TXT 文件（不拆解），后续可下载。</div>
        </div>
        <div id="txt-existing-book" class="form-group">
          <label>选择目标书籍 *</label>
          <select id="import-book"><option value="">加载中...</option></select>
        </div>
        <div id="txt-new-book" style="display:none">
          <div style="padding:12px;background:var(--bg);border-radius:var(--radius);margin-bottom:12px">
            <div class="form-group" style="margin-bottom:8px">
              <label>书名</label>
              <input type="text" id="txt-book-title" placeholder="书名" maxlength="200">
            </div>
            <div class="form-group" style="margin-bottom:8px">
              <label>作者</label>
              <input type="text" id="txt-book-author" placeholder="作者" maxlength="100">
            </div>
            <div class="form-group" style="margin-bottom:0">
              <label>简介</label>
              <textarea id="txt-book-desc" placeholder="简介" style="min-height:60px" maxlength="2000"></textarea>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label>选择 TXT 文件（支持 UTF-8 / GBK 编码，最大 50MB）</label>
          <input type="file" id="import-file" accept=".txt,.text" style="padding:8px 0">
        </div>
        <div id="import-preview" style="display:none">
          <div class="form-group">
            <label>章节分割预览（可取消勾选不需要的章节）</label>
            <div id="import-chapters" class="admin-list" style="max-height:300px;overflow-y:auto"></div>
            <div style="font-size:13px;color:var(--text-light);margin-top:6px">
              共 <span id="import-total">0</span> 章，<span id="import-words">0</span> 字
            </div>
          </div>
          <div class="import-progress" style="display:none">
            <div style="background:var(--bg-secondary);border-radius:10px;overflow:hidden;height:20px;margin:12px 0">
              <div id="import-bar" style="height:100%;background:var(--primary);border-radius:10px;transition:width 0.3s;width:0%"></div>
            </div>
            <div id="import-status" style="font-size:13px;color:var(--text-light)"></div>
          </div>
          <button class="btn" id="start-import-btn">开始导入</button>
          <button class="btn btn-sm" id="cancel-import-btn" style="margin-left:8px">取消</button>
        </div>
        <div id="import-msg"></div>
      </div>

      <!-- EPUB导入 -->
      <div class="admin-section">
        <h3>📖 EPUB 导入</h3>
        <div class="form-group">
          <label>选择 EPUB 文件（最大 50MB）</label>
          <input type="file" id="epub-file" accept=".epub" style="padding:8px 0">
        </div>
        <div id="epub-parsing-msg" style="display:none;padding:12px;background:var(--bg);border-radius:var(--radius);color:var(--text-light);font-size:14px">
          ⏳ 正在解析 EPUB 文件...
        </div>
        <div id="epub-preview" style="display:none">
          <div style="padding:12px;background:var(--bg);border-radius:var(--radius);margin-bottom:12px">
            <div class="form-group" style="margin-bottom:8px">
              <label>书名</label>
              <input type="text" id="epub-book-title" placeholder="书名" maxlength="200">
            </div>
            <div class="form-group" style="margin-bottom:8px">
              <label>作者</label>
              <input type="text" id="epub-book-author" placeholder="作者" maxlength="100">
            </div>
            <div class="form-group" style="margin-bottom:0">
              <label>简介</label>
              <textarea id="epub-book-desc" placeholder="简介" style="min-height:60px" maxlength="2000"></textarea>
            </div>
          </div>
          <div class="form-group">
            <label>章节列表（可取消勾选不需要的章节，可编辑标题）</label>
            <div id="epub-chapters" class="admin-list" style="max-height:400px;overflow-y:auto"></div>
            <div style="font-size:13px;color:var(--text-light);margin-top:6px">
              共 <span id="epub-total">0</span> 章，<span id="epub-words">0</span> 字
            </div>
          </div>
          <div class="form-group">
            <label>导入方式</label>
            <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
              <label style="display:flex;align-items:center;gap:4px;font-size:14px;cursor:pointer">
                <input type="radio" name="epub-import-mode" value="new" checked> 创建新书并导入
              </label>
              <label style="display:flex;align-items:center;gap:4px;font-size:14px;cursor:pointer">
                <input type="radio" name="epub-import-mode" value="existing"> 导入到已有书籍
              </label>
            </div>
          </div>
          <div id="epub-existing-book" style="display:none" class="form-group">
            <label>选择目标书籍</label>
            <select id="epub-book-select"><option value="">加载中...</option></select>
          </div>
          <div class="import-progress" id="epub-progress" style="display:none">
            <div style="background:var(--bg-secondary,var(--border));border-radius:10px;overflow:hidden;height:20px;margin:12px 0">
              <div id="epub-bar" style="height:100%;background:var(--primary,var(--accent));border-radius:10px;transition:width 0.3s;width:0%"></div>
            </div>
            <div id="epub-status" style="font-size:13px;color:var(--text-light)"></div>
          </div>
          <div style="display:flex;gap:8px">
            <button class="btn" id="start-epub-import-btn">开始导入</button>
            <button class="btn btn-sm" id="cancel-epub-import-btn">取消</button>
          </div>
        </div>
        <div id="epub-msg"></div>
      </div>

      <!-- 创建书籍 -->
      <div class="admin-section">
        <h3>📖 创建新书</h3>
        <div class="form-group">
          <label>书名 *</label>
          <input type="text" id="book-title" placeholder="输入书名" maxlength="200">
        </div>
        <div class="form-group">
          <label>作者</label>
          <input type="text" id="book-author" placeholder="输入作者名" maxlength="100">
        </div>
        <div class="form-group">
          <label>简介</label>
          <textarea id="book-desc" placeholder="输入书籍简介" style="min-height:80px" maxlength="2000"></textarea>
        </div>
        <button class="btn" id="create-book-btn">创建书籍</button>
        <div id="book-msg"></div>
      </div>

      <!-- 源文件收纳（任意格式） -->
      <div class="admin-section">
        <h3>📦 源文件收纳（任意格式）</h3>
        <div class="form-group">
          <label>选择文件（最大 200MB，将保留源格式）</label>
          <input type="file" id="source-file" style="padding:8px 0">
        </div>
        <div class="form-group">
          <label>书名 *</label>
          <input type="text" id="source-book-title" placeholder="默认取文件名" maxlength="200">
        </div>
        <div class="form-group">
          <label>作者</label>
          <input type="text" id="source-book-author" placeholder="可选" maxlength="100">
        </div>
        <div class="form-group">
          <label>简介</label>
          <textarea id="source-book-desc" placeholder="可选" style="min-height:60px" maxlength="2000"></textarea>
        </div>
        <button class="btn" id="create-book-from-source-btn">创建并上传源文件</button>
        <div id="source-book-msg"></div>
      </div>

      <!-- 书籍管理 -->
      <div class="admin-section">
        <h3>📚 书籍管理</h3>
        <ul class="admin-list" id="book-list"><li class="loading">加载中...</li></ul>
      </div>

      <!-- 漫画管理 -->
      <div class="admin-section">
        <h3>🖼️ 漫画（CBZ）</h3>
        <div class="form-group">
          <label>选择 CBZ 文件（最大 200MB，仅图片压缩包）</label>
          <input type="file" id="cbz-file" accept=".cbz,.zip" style="padding:8px 0">
        </div>
        <div id="cbz-parsing-msg" style="display:none;padding:12px;background:var(--bg);border-radius:var(--radius);color:var(--text-light);font-size:14px">
          ⏳ 正在解析 CBZ 文件...
        </div>
        <div id="cbz-preview" style="display:none">
          <div style="padding:12px;background:var(--bg);border-radius:var(--radius);margin-bottom:12px">
            <div class="form-group" style="margin-bottom:8px">
              <label>标题</label>
              <input type="text" id="cbz-title" placeholder="漫画标题" maxlength="200">
            </div>
            <div class="form-group" style="margin-bottom:0">
              <label>简介</label>
              <textarea id="cbz-desc" placeholder="可选" style="min-height:60px" maxlength="2000"></textarea>
            </div>
            <div style="font-size:12px;color:var(--text-light);margin-top:8px" id="cbz-summary"></div>
          </div>
          <div class="import-progress" id="cbz-progress" style="display:none">
            <div style="background:var(--bg-secondary,var(--border));border-radius:10px;overflow:hidden;height:20px;margin:12px 0">
              <div id="cbz-bar" style="height:100%;background:var(--primary,var(--accent));border-radius:10px;transition:width 0.3s;width:0%"></div>
            </div>
            <div id="cbz-status" style="font-size:13px;color:var(--text-light)"></div>
          </div>
          <div style="display:flex;gap:8px">
            <button class="btn" id="start-cbz-import-btn">开始导入漫画</button>
            <button class="btn btn-sm" id="cancel-cbz-import-btn">取消</button>
          </div>
        </div>
        <div id="cbz-msg"></div>

        <div style="margin-top:16px;padding-top:12px;border-top:1px solid var(--border)">
          <h4 style="margin:0 0 10px">已导入漫画</h4>
          <ul class="admin-list" id="comic-list"><li style="color:var(--text-light)">加载中...</li></ul>
        </div>
      </div>

      <!-- 标签管理 -->
      <div class="admin-section">
        <h3>🏷️ 标签管理</h3>
        <div style="display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap;align-items:end">
          <div>
            <label style="font-size:12px;color:var(--text-light)">标签名</label>
            <input type="text" id="tag-name" placeholder="标签名称" maxlength="30" style="width:140px;padding:6px 8px;border:1px solid var(--border);border-radius:var(--radius);background:var(--bg);color:var(--text)">
          </div>
          <div>
            <label style="font-size:12px;color:var(--text-light)">颜色</label>
            <input type="color" id="tag-color" value="#3498db" style="width:40px;height:32px;border:1px solid var(--border);border-radius:var(--radius);cursor:pointer;padding:2px">
          </div>
          <button class="btn" id="create-tag-btn">创建标签</button>
        </div>
        <ul class="admin-list" id="tag-list"><li style="color:var(--text-light)">加载中...</li></ul>
        <div id="tag-msg"></div>
      </div>

      <!-- 书籍编辑弹窗 -->
      <div class="settings-overlay" id="book-edit-overlay">
        <div class="settings-panel" style="max-width:500px;border-radius:var(--radius)">
          <h3>编辑书籍<button class="close-btn" id="close-book-edit">✕</button></h3>
          <input type="hidden" id="edit-book-id">
          <div class="form-group">
            <label>书名</label>
            <input type="text" id="edit-book-title" maxlength="200">
          </div>
          <div class="form-group">
            <label>作者</label>
            <input type="text" id="edit-book-author" maxlength="100">
          </div>
          <div class="form-group">
            <label>简介</label>
            <textarea id="edit-book-desc" style="min-height:60px" maxlength="2000"></textarea>
          </div>
          <div class="form-group">
            <label>封面图片</label>
            <div style="display:flex;gap:12px;align-items:center">
              <div id="edit-cover-preview" style="width:80px;height:107px;border:1px dashed var(--border);border-radius:var(--radius);display:flex;align-items:center;justify-content:center;overflow:hidden;background:var(--bg)">
                <span style="color:var(--text-light);font-size:12px">无封面</span>
              </div>
              <div>
                <input type="file" id="edit-cover-file" accept="image/*" style="font-size:13px;margin-bottom:6px">
                <div><button class="btn btn-sm btn-danger" id="remove-cover-btn" style="display:none">删除封面</button></div>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label>标签</label>
            <div id="edit-book-tags" style="display:flex;gap:6px;flex-wrap:wrap"></div>
          </div>
          <button class="btn" id="save-book-edit-btn">保存</button>
        </div>
      </div>

      <!-- 添加章节 -->
      <div class="admin-section">
        <h3>📝 添加章节</h3>
        <div class="form-group">
          <label>选择书籍 *</label>
          <select id="chapter-book"><option value="">加载中...</option></select>
        </div>
        <div class="form-group">
          <label>章节标题 *</label>
          <input type="text" id="chapter-title" placeholder="如：第一章 初入江湖" maxlength="200">
        </div>
        <div class="form-group">
          <label>章节内容 *</label>
          <textarea id="chapter-content" placeholder="在此输入章节正文..."></textarea>
          <div style="font-size:12px;color:var(--text-light);margin-top:4px">字数：<span id="word-count">0</span></div>
        </div>
        <button class="btn" id="create-chapter-btn">发布章节</button>
        <div id="chapter-msg"></div>
      </div>

      <!-- 章节管理 -->
      <div class="admin-section">
        <h3>📄 章节管理</h3>
        <div class="form-group">
          <label>选择书籍</label>
          <select id="manage-book"><option value="">选择书籍...</option></select>
        </div>
        <div id="batch-bar" style="display:none;margin-bottom:12px;padding:10px;background:var(--bg);border:1px solid var(--border);border-radius:var(--radius);display:flex;align-items:center;gap:12px">
          <label style="font-size:13px;display:flex;align-items:center;gap:4px"><input type="checkbox" id="select-all">全选</label>
          <span style="font-size:13px;color:var(--text-light)" id="selected-count">已选 0 章</span>
          <button class="btn btn-danger btn-sm" id="batch-delete-btn">批量删除</button>
        </div>
        <ul class="admin-list" id="chapter-list"></ul>
        <div style="margin-top:8px" id="export-area"></div>
        <div id="manage-msg"></div>
      </div>

      <!-- 自定义字体管理 -->
      <div class="admin-section super-admin-only" style="display:none">
        <h3>🔤 自定义字体</h3>
        <div class="form-group">
          <label>上传 .woff2 字体文件（最大10MB）</label>
          <div style="display:flex;gap:8px;align-items:center">
            <input type="file" id="font-file" accept=".woff2" style="padding:8px 0;flex:1">
            <button class="btn" id="upload-font-btn">上传</button>
          </div>
        </div>
        <ul class="admin-list" id="font-list"><li style="color:var(--text-light)">加载中...</li></ul>
        <div id="font-msg"></div>
      </div>

      <!-- 数据备份与恢复 -->
      <div class="admin-section super-admin-only" style="display:none">
        <h3>💾 数据备份与恢复</h3>
        <p style="font-size:13px;color:var(--text-light);margin-bottom:12px">导出全站数据（书籍+章节正文+设置）为 JSON 文件，或从备份文件恢复。</p>
        <button class="btn" id="backup-btn">导出备份</button>
        <label class="btn" style="cursor:pointer;background:var(--accent-dark)">
          导入恢复
          <input type="file" id="restore-file" accept=".json" style="display:none">
        </label>
        <div id="backup-progress" style="display:none;margin-top:12px">
          <div style="background:var(--border);border-radius:10px;overflow:hidden;height:20px">
            <div id="backup-bar" style="height:100%;background:var(--accent);border-radius:10px;transition:width 0.3s;width:0%"></div>
          </div>
          <div id="backup-status" style="font-size:13px;color:var(--text-light);margin-top:4px"></div>
        </div>
        <div id="backup-msg"></div>
      </div>

      <!-- 管理员管理（仅超管可见） -->
      <div class="admin-section super-admin-only" style="display:none">
        <h3>👥 管理员管理</h3>
        <div id="admin-users-list" style="margin-bottom:12px"></div>
        <details style="margin-top:8px">
          <summary style="cursor:pointer;font-size:14px;color:var(--accent)">+ 添加管理员</summary>
          <div style="display:grid;grid-template-columns:1fr 1fr auto;gap:8px;margin-top:8px;align-items:end">
            <div>
              <label style="font-size:12px;color:var(--text-light)">用户名</label>
              <input type="text" id="new-admin-user" placeholder="字母数字下划线" style="width:100%;padding:6px 8px;border:1px solid var(--border);border-radius:var(--radius);background:var(--bg);color:var(--text)">
            </div>
            <div>
              <label style="font-size:12px;color:var(--text-light)">密码</label>
              <input type="password" id="new-admin-pass" placeholder="至少8位" style="width:100%;padding:6px 8px;border:1px solid var(--border);border-radius:var(--radius);background:var(--bg);color:var(--text)">
            </div>
            <button class="btn" id="create-admin-btn">创建</button>
          </div>
          <div style="margin-top:4px">
            <label style="font-size:12px;color:var(--text-light)">角色：</label>
            <select id="new-admin-role" style="padding:2px 6px;border:1px solid var(--border);border-radius:4px;background:var(--bg);color:var(--text);font-size:13px">
              <option value="demo">演示管理员</option>
              <option value="admin">管理员</option>
              <option value="super_admin">超级管理员</option>
            </select>
          </div>
          <div style="margin-top:4px">
            <label style="font-size:12px;color:var(--text-light)">
              <input type="checkbox" id="new-admin-pwd-lock"> 禁止修改密码
            </label>
          </div>
          <div id="admin-user-msg"></div>
        </details>
      </div>

    </div><!-- /admin-panel -->
  </div>
  <script type="module" src="/assets/js/pages/admin.js"></script>
</body>
</html>
